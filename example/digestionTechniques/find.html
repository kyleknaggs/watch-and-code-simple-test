<script src="../../simpletest.js"></script>
<script>
  // MDN notes for .find()

  // Description:
  // Returns the first value of the element in the array that satisfies the provided testingn function.

  // MDN Example:
  // ([5, 12, 8, 130, 44], function(element) {
  //  return element > 10;
  // });

  // Function signature
  // Syntax:
  // find(originalArray, callback[, optionalThis])

  // Callback Parameters
  // currentValue
  // optional currentIndex
  // optional originalArray

  // Return value:
  // The first element in the array that satisfies the callback.
  // Otherwise undefined is returned.

  // Questions:
  // 1) What type of value does callback return?

  // -----------------------------

  // Requirements:

  // 1) Executes callback.
  // find([1], function() {
  // });
  // Expect: Callback should run once.

  // 2) Executes callback for every index in the array.
  // find([1, 2], function() {
  // });
  // Expect: Callback should run twice.

  // ----------

  // 3) Callback has access to ith element of the array.
  // find([1], function(currentElement) {
  //   console.log(currentElement);
  // });
  // Expect: currentElement === 1;

  // 4) Callback has access to index.
  // find([1], function(currentElement, currentIndex) {
  //   console.log(currentIndex);
  // });
  // Expect: currentIndex === 0;

  // 5) Callback has access to originalArray.
  // find([1], function(currentElement, currentIndex, originalArray) {
  //   console.log(originalArray);
  // });
  // Expect: originalArray[0] === 1;
  // Expect: originalArray.length === 1;

  // 6) Callback should accept optionalThis.
  // find([1], function(currentElement) {
  //   console.log(this.description);
  // }, {description: 'This is an optional this argument.'});

  // ----------

  // 7) It should not execute callback after callback returns truthy.
  // find([1, 2], function(currentElement) {
  //   return true;
  // });
  // Expect: Callback should run once.

  // 8) It should return currentElement if callback evaluates to truthy.
  // var originalValue = 1
  // var returnedValue = find([originalValue], function(currentElement) {
  //   return true;
  // });
  // Expect: originalValue === returnedValue;

  // 9) It should not return currentElement if callback evaluates to falsey.
  // var originalValue = 1
  // var returnedValue = find([originalValue], function(currentElement) {
  //   return false;
  // });
  // Expect: originalValue !== returnedValue;

  // 10) It should return only the value of the first element that evaluates to truthy.
  // var returnedValue = find([1,2,3], function(currentElement) {
  //   return currentElement > 1;
  // });
  // Expect: returnedValue === 2;

  // 11) It should return undefined if no element evaluates to truthy when passed to callback.
  // var returnedValue = find([1], function(currentElement) {
  //   return false;
  // });
  // Expect: returnedValue === undefined;

  // ----------

  // 12) It should not mutate the array on which it is called.
  // var originalArray = [1]
  // var duplicateOriginalArray = originalArray;
  // var returnedValue = find(originalArray, function(currentElement) {
  //   return false;
  // });
  // Expect: duplicateOriginalArray === originalArray;

  // -----------------------------

  function find(originalArray, callback, optionalThis) {
    var findCallback = callback;

    // If optionalThis is passed to find.
    if (optionalThis) {
      findCallback = findCallback.bind(optionalThis);
    }

    for (var i = 0; i < originalArray.length; i++) {
      var callbackResult = findCallback(originalArray[i], i, originalArray);
      if (callbackResult) {
        return originalArray[i];
      }
    }
  }

  tests({
    "Callback should execute.": function() {
      var numberOfTimeCallbackHasRun = 0;
      find([1], function() {
        numberOfTimeCallbackHasRun++;
      });
      eq(numberOfTimeCallbackHasRun, 1);
    },
    "Callback should execute once for each index that does not return truthy.": function() {
      var numberOfTimeCallbackHasRun = 0;
      find([1, 2], function() {
        numberOfTimeCallbackHasRun++;
      });
      eq(numberOfTimeCallbackHasRun, 2);
    },

    // ----------

    "Callback has access to ith element of the array": function() {
      find([1], function(currentElement) {
        eq(currentElement, 1);
      });
    },
    "Callback has access to index": function() {
      find([1], function(currentElement, currentIndex) {
        eq(currentIndex, 0);
      });
    },
    "Callback has access to originalArray.": function() {
      find([1], function(currentElement, currentIndex, originalArray) {
        eq(originalArray[0], 1);
        eq(originalArray.length, 1);
      });
    },
    "Callback should accept an optional this argument.": function() {
      find(
        [1],
        function() {
          eq(this.description, "This is an optional this argument.");
        },
        {
          description: "This is an optional this argument."
        }
      );
    },

    // ----------

    "Callback should not execute after a truthy value has been returned.": function() {
      var numberOfTimeCallbackHasRun = 0;
      find([1, 2], function(currentElement) {
        numberOfTimeCallbackHasRun++;
        return true;
      });
      eq(numberOfTimeCallbackHasRun, 1);
    },

    "It should return currentElement if callback evaluates to truthy.": function() {
      var originalValue = 1;
      var returnedValue = find([originalValue], function(currentElement) {
        return true;
      });
      eq(originalValue, returnedValue);
    },
    "It should not return currentElement if callback evaluates to falsey.": function() {
      var originalValue = 1;
      var returnedValue = find([originalValue], function(currentElement) {
        return false;
      });
      eq(originalValue !== returnedValue, true);
    },
    "It should return only the value of the first element that evaluates to truthy.": function() {
      var returnedValue = find([1, 2, 3], function(currentElement) {
        return currentElement > 1;
      });
      eq(returnedValue, 2);
    },
    "It should return undefined if no element evaluates to truthy when passed to callback.": function() {
      var returnedValue = find([1], function(currentElement) {
        return false;
      });
      eq(returnedValue, undefined);
    },

    // ----------

    "It should not mutate the array on which it is called.": function() {
      var originalArray = [1];
      var duplicateOriginalArray = originalArray;
      var returnedValue = find(originalArray, function(currentElement) {
        return false;
      });
      eq(duplicateOriginalArray, originalArray);
    }
  });
</script>
